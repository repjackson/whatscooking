template(name='tribes')
    .ui.stackable.padded.grid
        .row
            .six.wide.column
                +icolor name='log-cabin' classes='ui inline mini image'
                .ui.inline.header 
                    |tribes
                if currentUser
                    .ui.basic.cricular.icon.button.add_tribe(title='add tribe')
                        i.plus.icon
                +cloud filter='tribe'
            .ten.wide.column.scrolling
                each tribes
                    +tribe_card
                    
                    
                    
                    
template(name='tribe_card')
    .ui.fluid.segment.stackable.grid
        a.four.wide.column(href="/tribe/#{slug}")
            if image_id
                img.ui.fluid.image(src="{{c.url image_id}}")
        .twelve.wide.column
            a.ui.header(href="/tribe/#{slug}")
                |#{title}
            |#{member_ids.length} members
            |!{description}
            //- +ismall name='tags' classes='ui inline image'
            each tags
                .ui.basic.label #{this}
            div
            if is_admin
                .ui.small.header slug: #{slug}
            if can_edit
                a.ui.circular.basic.icon.button(href="/tribe/#{_id}/edit")
                    i.pencil.blue.icon



template(name='tribe_edit')
    with cd
        .ui.stackable.padded.grid
            .row
                .four.wide.column
                .eight.wide.column
                    .ui.header 
                        i.pencil.icon
                        if icon
                            +icolor name=icon
                        |edit '#{title}' tribe
                .four.wide.column
                    a.ui.big.circular.basic.button(href="/tribe/#{slug}" title='save')
                        i.green.checkmark.icon
                        |save
            .row
                .four.wide.column 
                    //- .ui.header
                    //-     |#{title}
                    +remove_button
                    +color_icon_edit key='icon' label='icon'
                    div
                    +slug_edit key='slug' label='tribe slug'
                    +array_edit key='tags' label='tags' icon='tags'
                    +link_edit key='link' label='link' icon='link'
                    +single_user_edit key='leader' label='leader'
                .six.wide.column 
                    +text_edit key='title' label='title' icon='title'
                    .spacer
                    +image_edit key='image_id' label='image' icon='image'
                .six.wide.column
                    +html_edit key='description' label='description' icon='content'
                     
                     
                     
template(name='tribe_view')
    with current_tribe
        .ui.stackable.padded.grid
            .middle.aligned.row
                .four.wide.column
                    a.ui.circular.basic.button(href="/tribes")
                        i.left.chevron.icon
                        +icolor name='log-cabin' classes='ui mini inline image'
                        |tribes
                .eight.wide.column 
                    .ui.center.aligned.header 
                        if icon
                            +icolor name=icon
                        |#{title}
                .four.wide.column 
                    if can_edit
                        a.ui.circular.basic.button(href="/tribe/#{_id}/edit")
                            i.pencil.blue.icon
                            |edit
            .row
                .four.wide.column 
                    +image_view key='image_id' icon='image' label='image'
                    +array_view key='tags' icon='tags'
                    .spacer
                    if link
                        a.ui.basic.circular.button(href=link target='_window')
                            i.external.icon
                            |view external site
                        .spacer
                    div
                    +viewing
                .six.wide.column
                    +html_view key='description' icon='content' label='description'
                    .ui.inline.header 
                        +icolor name='crown'
                        |tribe leader: 
                    a.ui.basic.button(href="/user/#{leader}")
                        |#{leader}
                    .ui.header 
                        +icolor name='groups'
                        |#{members.count} members
                    .ui.large.selection.animated.list
                        each members 
                            a.item(href="/user/#{username}")
                                img.ui.mini.image(src="{{c.url profile_image_id width=200 height=200}}")
                                .content
                                    .header
                                        |#{username}
                    .ui.header #{meal_count} total meals
                    each tribe_meals
                        .ui.small.header #{dish.title}
                    .ui.header #{upcoming_meal_count} upcoming meals
                    each upcoming_tribe_meals
                        .ui.small.header #{dish.title}
                .six.wide.column 
                    +doc_array_togggle key='member_ids' value=currentUser._id add_label='join' remove_label='joined'
                    .ui.header 
                        +i name='rss'
                        |activity
                    each log_items
                        +log_item
                    //- +comments


template(name='latest_tribe_updates')
    .ui.header 
        +i name='clock'
        |latest tribe updates
    .ui.link.list
        each latest_updates
            a.item(href="/tribe/#{parent_id}/view") 
                +ismall name=tribe.icon
                .ui.small.inline.header 
                    |#{tribe.title}: 
                strong #{text}
            |#{when}
