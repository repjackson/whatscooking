template(name='meal_view')
    with cd
        .ui.stackable.padded.grid
            .middle.aligned.row
                .four.wide.center.aligned.column
                    a.ui.basic.circular.button(href="/")
                        i.large.left.chevron.icon
                        |meals
                .eight.wide.center.aligned.column
                    .ui.large.header 
                        small viewing
                        |'#{meal_dish.title}'
                        small meal
                .four.wide.center.aligned.column
                    if can_edit
                        a.ui.large.basic.circular.button(href="/meal/#{_id}/edit")
                            i.pencil.blue.icon
                            |edit
            .three.column.row
                .column
                    .ui.segment
                        .ui.header dish
                        //- a.ui.fluid.basic.button(href="/meals")
                        //-     +icolor name='real-food-for-meals' classes='ui mini inline image'
                        //-     |meals
                        img.ui.fluid.image(src="{{c.url meal_dish.image_id width=400 height=400}}")
                                
                        a.ui.basic.circular.button(href="/dish/#{dish_id}/view")
                            |view dish
                        +array_view key='tags' direct=true
                        //- +array_view key='ingredients' direct=true
                        //- +array_view key='location_tags' direct=true
                        div
                        .ui.inline.header 
                            small available 
                            |{{from_now datetime_available}}:
                        +html_view key='description' direct=true
                        .ui.small.inline.header {{long_date datetime_available}}
                        .ui.header 
                            +icolor name='ingredients'
                            |ingredients
                        with meal_dish
                            each dish_ingredients
                                .ui.large.basic.circular.label
                                    |#{title}
                    .ui.dividing.header
                        |rules
                    .ui.header #{servings_amount} total servings amount
                    .ui.header $#{price_per_serving}/serving
                    .ui.header #{servings_available} servings available
                    .ui.header
                        if pickup
                            i.checkmark.icon
                        else 
                            |no
                        |pickup
                    .ui.header 
                        if delivery
                            i.checkmark.icon
                        else 
                            |no
                        |delivery
                .column
                    .ui.header #{servings_left} 
                        if serving_unit
                            |#{serving_unit}s
                        else 
                            |servings
                        | left
                    if can_order
                        +order_button
                    .ui.header 
                        |orders
                    each meal_orders
                        .ui.segment(class=meal_order_class)
                            .ui.inline.green.header
                                |$#{order_price}
                            a.ui.small.inline.header(href="/user/#{_author.username}" title='view profile')
                                if _author.profile_image_id
                                    img.ui.avatar.image(src="{{c.url _author.profile_image_id width=100 height=100 gravity='face' crop='fill'}}")
                                |#{_author.username}
                            div
                            .ui.small.inline.header
                                | #{when} ({{long_date _timestamp}})
                            a.ui.compact.circular.basic.button(href="/order/#{_id}/view")
                                |view details
                                i.right.chevron.icon
                            if can_edit
                                .ui.small.compact.basic.button.cancel_order
                                    i.remove.red.icon
                                    |cancel
                    .ui.hidden.divider
                    +comments
                .column
                    .ui.header cook #{_author_username}
                    with _author
                        +user_card
                    with cd
                        +voting_full
                        .ui.header similar meals
                        .ui.header alerts
                        |alergen alert
                        |#{alergen_alert}


template(name='order_button')
    if servings_left
        .ui.green.fluid.large.button.order_meal
            i.cart.plus.icon
            |order #{serving_unit}
    else 
        .ui.teal.large.fluid.button.join_waitlist
            i.clock.icon
            |join wait list
        
